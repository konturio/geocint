drop table if exists stat_h3_quality;
create table stat_h3_quality as (
    select *
    from
        (
            select
                h3_cell_to_parent(a.h3) as h3_parent,
                avg(a.count) as agg_count,
                avg(a.count_6_months) as agg_count_6_months,
                avg(a.building_count) as agg_building_count,
                avg(a.building_count_6_months) as agg_building_count_6_months,
                avg(a.highway_length) as agg_highway_length,
                avg(a.highway_length_6_months) as agg_highway_length_6_months,
                avg(a.osm_users) as agg_osm_users,
                avg(a.population) as agg_population,
                avg(a.residential) as agg_residential,
                avg(a.gdp) as agg_gdp,
                avg(a.min_ts) as agg_min_ts,
                avg(a.max_ts) as agg_max_ts,
                avg(a.avgmax_ts) as agg_avgmax_ts,
                avg(a.local_hours) as agg_local_hours,
                avg(a.total_hours) as agg_total_hours,
                avg(a.view_count) as agg_view_count,
                avg(a.area_km2) as agg_area_km2,
                avg(a.populated_area_km2) as agg_populated_area_km2,
                avg(a.one) as agg_one,
                avg(a.total_building_count) as agg_total_building_count,
                avg(a.wildfires) as agg_wildfires,
                -- avg(a.covid19_vaccines) as agg_covid19_vaccines,
                avg(a.avg_slope_gebco_2022) as agg_avg_slope_gebco_2022,
                avg(a.avg_elevation_gebco_2022) as agg_avg_elevation_gebco_2022,
                avg(a.forest) as agg_forest,
                avg(a.avg_ndvi) as agg_avg_ndvi,
                avg(a.covid19_confirmed) as agg_covid19_confirmed,
                avg(a.population_prev) as agg_population_prev,
                avg(a.industrial_area) as agg_industrial_area,
                avg(a.volcanos_count) as agg_volcanos_count,
                avg(a.pop_under_5_total) as agg_pop_under_5_total,
                avg(a.pop_over_65_total) as agg_pop_over_65_total,
                avg(a.poverty_families_total) as agg_poverty_families_total,
                avg(a.pop_disability_total) as agg_pop_disability_total,
                avg(a.pop_not_well_eng_speak) as agg_pop_not_well_eng_speak,
                avg(a.pop_without_car) as agg_pop_without_car,
                avg(a.evergreen_needle_leaved_forest) as agg_evergreen_needle_leaved_forest,
                avg(a.shrubs) as agg_shrubs,
                avg(a.herbage) as agg_herbage,
                avg(a.unknown_forest) as agg_unknown_forest,
                avg(a.cropland) as agg_cropland,
                avg(a.wetland) as agg_wetland ,
                avg(a.moss_lichen) as agg_moss_lichen,
                avg(a.bare_vegetation) as agg_bare_vegetation,
                avg(a.builtup) as agg_builtup,
                avg(a.snow_ice) as agg_snow_ice,
                avg(a.permanent_water) as agg_permanent_water,
                avg(a.days_maxtemp_over_32c_1c) as agg_days_maxtemp_over_32c_1c,
                avg(a.days_maxtemp_over_32c_2c) as agg_days_maxtemp_over_32c_2c,
                avg(a.days_mintemp_above_25c_1c) as agg_days_mintemp_above_25c_1c,
                avg(a.days_mintemp_above_25c_2c) as agg_days_mintemp_above_25c_2c,
                avg(a.days_maxwetbulb_over_32c_1c) as agg_days_maxwetbulb_over_32c_1c,
                avg(a.days_maxwetbulb_over_32c_2c) as agg_days_maxwetbulb_over_32c_2c,
                avg(a.mandays_maxtemp_over_32c_1c) as agg_mandays_maxtemp_over_32c_1c,
                avg(a.man_distance_to_fire_brigade) as agg_man_distance_to_fire_brigade,
                avg(a.man_distance_to_hospital) as agg_man_distance_to_hospital,
                avg(a.total_road_length) as agg_total_road_length,
                avg(a.foursquare_places_count) as agg_foursquare_places_count,
                avg(a.foursquare_visits_count) as agg_foursquare_visits_count,
                avg(a.view_count_bf2402) as agg_view_count_bf2402,
                avg(a.hazardous_days_count) as agg_hazardous_days_count,
                avg(a.earthquake_days_count) as agg_earthquake_days_count,
                avg(a.drought_days_count) as agg_drought_days_count,
                avg(a.cyclone_days_count) as agg_cyclone_days_count,
                avg(a.wildfire_days_count) as agg_wildfire_days_count,
                avg(a.volcano_days_count) as agg_volcano_days_count,
                avg(a.flood_days_count) as agg_flood_days_count,
                avg(a.powerlines::float) as agg_powerlines,
                avg(a.night_lights_intensity::float) as agg_night_lights_intensity,
                avg(a.eatery_count::float) as agg_eatery_count,
                avg(a.food_shops_count::float) as agg_food_shops_count,
                avg(a.mapswipe_area_km2::float) as agg_mapswipe_area_km2,
                avg(a.gsa_ghi::float) as agg_gsa_ghi,
                avg(a.worldclim_avg_temperature::float) as agg_worldclim_avg_temperature,
                avg(a.worldclim_min_temperature::float) as agg_worldclim_min_temperature,
                avg(a.worldclim_max_temperature::float) as agg_worldclim_max_temperature,
                avg(a.worldclim_amp_temperature::float) as agg_worldclim_amp_temperature,
                avg(a.man_distance_to_bomb_shelters) as agg_man_distance_to_bomb_shelters,
                avg(a.man_distance_to_charging_stations) as agg_man_distance_to_charging_stations,
                avg(a.powerlines_proximity_m::float) as agg_powerlines_proximity_m,
                avg(a.waste_basket_coverage_area_km2) as agg_waste_basket_coverage_area_km2,
                avg(a.populated_areas_proximity_m::float) as agg_populated_areas_proximity_m,
                avg(a.power_substations_proximity_m::float) as agg_power_substations_proximity_m,
                avg(a.solar_farms_placement_suitability::float) as agg_solar_farms_placement_suitability,
                avg(a.solar_power_plants::float) as agg_solar_power_plants,
                avg(a.safety_index::float) as agg_safety_index,
                avg(a.raw_mhe_pop_scaled) as agg_raw_mhe_pop_scaled,
                avg(a.raw_mhe_cap_scaled) as agg_raw_mhe_cap_scaled,
                avg(a.raw_mhe_index) as agg_raw_mhe_index,
                avg(a.relative_mhe_pop_scaled) as agg_relative_mhe_pop_scaled,
                avg(a.relative_mhe_cap_scaled) as agg_relative_mhe_cap_scaled,
                avg(a.relative_mhe_index) as agg_relative_mhe_index,
                avg(a.mhe_index) as agg_mhe_index,
                avg(a.life_expectancy_scale) as agg_life_expectancy_scale,
                avg(a.infant_mortality_scale) as agg_infant_mortality_scale,
                avg(a.maternal_mortality_scale) as agg_maternal_mortality_scale,
                avg(a.prevalence_undernourished_scale) as agg_prevalence_undernourished_scale,
                avg(a.vulnerable_health_status_index) as agg_vulnerable_health_status_index,
                avg(a.pop_wout_improved_sanitation_scale) as agg_pop_wout_improved_sanitation_scale,
                avg(a.pop_wout_improved_water_scale) as agg_pop_wout_improved_water_scale,
                avg(a.clean_water_access_vulnerability_index) as agg_clean_water_access_vulnerability_index,
                avg(a.adult_illiteracy_scale) as agg_adult_illiteracy_scale,
                avg(a.gross_enrollment_scale) as agg_gross_enrollment_scale,
                avg(a.years_of_schooling_scale) as agg_years_of_schooling_scale,
                avg(a.pop_wout_internet_scale) as agg_pop_wout_internet_scale,
                avg(a.info_access_vulnerability_index) as agg_info_access_vulnerability_index,
                avg(a.export_minus_import_percent_scale) as agg_export_minus_import_percent_scale,
                avg(a.average_inflation_scale) as agg_average_inflation_scale,
                avg(a.economic_dependency_scale) as agg_economic_dependency_scale,
                avg(a.economic_constraints_index) as agg_economic_constraints_index,
                avg(a.female_govt_seats_scale) as agg_female_govt_seats_scale,
                avg(a.female_male_secondary_enrollment_scale) as agg_female_male_secondary_enrollment_scale,
                avg(a.female_male_labor_ratio_scale) as agg_female_male_labor_ratio_scale,
                avg(a.gender_inequality_index) as agg_gender_inequality_index,
                avg(a.max_political_discrimination_scale) as agg_max_political_discrimination_scale,
                avg(a.max_economic_discrimination_scale) as agg_max_economic_discrimination_scale,
                avg(a.ethnic_discrimination_index) as agg_ethnic_discrimination_index,
                avg(a.marginalization_index) as agg_marginalization_index,
                avg(a.population_change_scale) as agg_population_change_scale,
                avg(a.urban_population_change_scale) as agg_urban_population_change_scale,
                avg(a.population_pressures_index) as agg_population_pressures_index,
                avg(a.freshwater_withdrawals_scale) as agg_freshwater_withdrawals_scale,
                avg(a.forest_area_change_scale) as agg_forest_area_change_scale,
                avg(a.ruminant_density_scale) as agg_ruminant_density_scale,
                avg(a.environmental_stress_index) as agg_environmental_stress_index,
                avg(a.recent_disaster_losses_scale) as agg_recent_disaster_losses_scale,
                avg(a.recent_disaster_deaths_scale) as agg_recent_disaster_deaths_scale,
                avg(a.recent_disaster_impacts_index) as agg_recent_disaster_impacts_index,
                avg(a.recent_conflict_deaths_scale) as agg_recent_conflict_deaths_scale,
                avg(a.displaced_populations_scale) as agg_displaced_populations_scale,
                avg(a.conflict_impacts_index) as agg_conflict_impacts_index,
                avg(a.vulnerability_index) as agg_vulnerability_index,
                avg(a.voice_and_accountability_scale) as agg_voice_and_accountability_scale,
                avg(a.rule_of_law_scale) as agg_rule_of_law_scale,
                avg(a.political_stability_scale) as agg_political_stability_scale,
                avg(a.govt_effectiveness_scale) as agg_govt_effectiveness_scale,
                avg(a.control_of_corruption_scale) as agg_control_of_corruption_scale,
                avg(a.governance_index) as agg_governance_index,
                avg(a.gni_per_capita_scale) as agg_gni_per_capita_scale,
                avg(a.reserves_per_capita_scale) as agg_reserves_per_capita_scale,
                avg(a.economic_capacity_index) as agg_economic_capacity_index,
                avg(a.fixed_phone_access_scale) as agg_fixed_phone_access_scale,
                avg(a.mobile_phone_access_scale) as agg_mobile_phone_access_scale,
                avg(a.internet_server_access_scale) as agg_internet_server_access_scale,
                avg(a.communications_capacity_index) as agg_communications_capacity_index,
                avg(a.port_rnwy_density_scale) as agg_port_rnwy_density_scale,
                avg(a.road_rr_density_scale) as agg_road_rr_density_scale,
                avg(a.transportation_index) as agg_transportation_index,
                avg(a.hospital_bed_density_scale) as agg_hospital_bed_density_scale,
                avg(a.nurses_midwives_scale) as agg_nurses_midwives_scale,
                avg(a.physicians_scale) as agg_physicians_scale,
                avg(a.health_care_capacity_index) as agg_health_care_capacity_index,
                avg(a.infrastructure_capacity_index) as agg_infrastructure_capacity_index,
                avg(a.biome_protection_scale) as agg_biome_protection_scale,
                avg(a.marine_protected_area_scale) as agg_marine_protected_area_scale,
                avg(a.environmental_capacity_index) as agg_environmental_capacity_index,
                avg(a.coping_capacity_index) as agg_coping_capacity_index,
                avg(a.resilience_index) as agg_resilience_index,
                avg(a.mhr_index) as agg_mhr_index,
                avg(a.raw_population_exposure_index) as agg_raw_population_exposure_index,
                avg(a.raw_economic_exposure) as agg_raw_economic_exposure,
                avg(a.relative_population_exposure_index) as agg_relative_population_exposure_index,
                avg(a.relative_economic_exposure) as agg_relative_economic_exposure,
                avg(a.poverty) as agg_poverty,
                avg(a.economic_dependency) as agg_economic_dependency,
                avg(a.maternal_mortality) as agg_maternal_mortality,
                avg(a.infant_mortality) as agg_infant_mortality,
                avg(a.malnutrition) as agg_malnutrition,
                avg(a.population_change) as agg_population_change,
                avg(a.urban_pop_change) as agg_urban_pop_change,
                avg(a.school_enrollment) as agg_school_enrollment,
                avg(a.years_of_schooling) as agg_years_of_schooling,
                avg(a.fem_to_male_labor) as agg_fem_to_male_labor,
                avg(a.proportion_of_female_seats_in_government) as agg_proportion_of_female_seats_in_government,
                avg(a.life_expectancy) as agg_life_expectancy,
                avg(a.protected_area) as agg_protected_area,
                avg(a.physicians_per_10000_persons) as agg_physicians_per_10000_persons,
                avg(a.nurse_midwife_per_10k) as agg_nurse_midwife_per_10k,
                avg(a.distance_to_hospital) as agg_distance_to_hospital,
                avg(a.hbeds_per_10000_persons) as agg_hbeds_per_10000_persons,
                avg(a.distance_to_port) as agg_distance_to_port,
                avg(a.road_density) as agg_road_density,
                avg(a.households_with_fixed_phone) as agg_households_with_fixed_phone,
                avg(a.households_with_cell_phone) as agg_households_with_cell_phone,
                avg(a.voter_participation) as agg_voter_participation
                avg(a.stddev_accel) as agg_stddev_accel
            from
                stat_h3 a
            where
                a.resolution between 1 and 6
            group by 1 ) a
    join stat_h3 b on a.h3_parent = b.h3
);

